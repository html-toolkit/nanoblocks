/*! v0.1.0 â€” 2015-05-27 */

!function(exports,global){global.nb=exports;var nb=exports;Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),nb.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},nb.extend=function(a){for(var b=[].slice.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a},nb.node={},nb.node.data=function(node,key,value){function parseValue(value){var ch=value.charAt(0);return"["===ch||"{"===ch?eval("("+value+")"):value}if(!key){for(var data={},attrs=node.attributes,r,i=0,l=attrs.length;l>i;i++){var attr=attrs[i];(r=/^data-nb-(.+)/.exec(attr.name))&&(data[r[1]]=parseValue(attr.value))}return data}return void 0===value?parseValue(node.getAttribute("data-nb-"+key)||""):void node.setAttribute("data-nb-"+key,value)},nb.node.getMod=function(a,b){return nb.node.setMod(a,b)};var modCache={};nb.node.setMod=function(a,b,c){var d=modCache[b]||(modCache[b]=RegExp("(?:^|\\s+)"+b+"(?:_([\\w-]+))?(?:$|\\s+)")),e=a.className;if(void 0===c){var f=d.exec(e);return f?void 0===f[1]?!0:f[1]:""}e=e.replace(d," ").trim(),c!==!1&&""!==c&&(e+=" "+b+(c===!0?"":"_"+c)),a.className=e},nb.node.delMod=function(a,b){nb.node.setMod(a,b,!1)};var _factories={},_docEvents={},_domEvents=["click","dblclick","mouseup","mousedown","keydown","keypress","keyup","input","change","blur","mouseover","mouseout","focusin","focusout"],_rx_domEvents=new RegExp("^("+_domEvents.join("|")+")\\b\\s*(.*)?$"),_id=0,_cache={},_getName=function(a){var b=a.getAttribute("data-nb");return b?b.trim().replace(/\s+/g," "):b},_getNames=function(a){return a.split(/\s+/)},Block=function(){};Block.prototype.__init=function(a){this.node=a,this.__handlers={},this.__bindEvents(),this.trigger("init"),space&&nb.trigger("inited:"+this.id,this)},Block.prototype.__bindEvents=function(){for(var a=this,b=Factory.get(this.name).events,c=0,d=b.length;d>c;c++){var e=b[c].custom,f=b[c].local;for(var g in e)!function(b){a.__bindCustomEvent(g,function(c,d){for(var e=b.length;e--;){var f=b[e].call(a,c,d);if(f===!1||null===f)return f}})}(e[g]);for(var g in f)for(var h in f[g])for(var i=(h||"").length?" "+h:"",j=g+i,k=f[g][h],c=0;c<k.length;c++)!function(b){a.on(j,function(){b.apply(a,arguments)})}(k[c])}},Block.prototype.destroy=function(){for(var a=Factory.get(this.name).events,b=0,c=a.length;c>b;b++){for(var d in a[b].custom)this.off(d);for(var d in a[b].local)this.off(d)}_cache[this.id]=null},Block.prototype.__getHandlers=function(a){var b=this.__handlers;return b[a]||(b[a]=[])},Block.prototype.on=function(a,b){var c=_rx_domEvents.exec(a);return c?$(this.node).on(c[1],c[2]||"",b):this.__bindCustomEvent(a,b),b},Block.prototype.__bindCustomEvent=function(a,b){this.__getHandlers(a).push(b)},Block.prototype.off=function(a,b){var c=_rx_domEvents.exec(a);if(c)$(this.node).off(c[1],c[2]||"",b);else if(b){var d=this.__getHandlers(a),e=d.indexOf(b);-1!==e&&d.splice(e,1)}else this.__handlers[a]=null},Block.prototype.trigger=function(a,b){for(var c=this.__getHandlers(a).slice(),d=0,e=c.length;e>d;d++)c[d].call(this,a,b)},Block.prototype.nbdata=function(a,b){return nb.node.data(this.node,a,b)},Block.prototype.show=function(){$(this.node).removeClass("_hidden"),this.trigger("show")},Block.prototype.hide=function(){$(this.node).addClass("_hidden"),this.trigger("hide")},Block.prototype.getMod=function(a){return nb.node.setMod(this.node,a)},Block.prototype.setMod=function(a,b){nb.node.setMod(this.node,a,b)},Block.prototype.delMod=function(a){nb.node.setMod(this.node,a,!1)},Block.prototype.children=function(){for(var a=[],b=$(this.node).find("[data-nb]"),c=0,d=b.length;d>c;c++)a=a.concat(nb.blocks(b[c]));return a},nb.Block=Block;var Factory=function(a,b,c){this.name=a,b.prototype.name=a,this.ctor=b,this.events=this._prepareEvents(c)};Factory.prototype._prepareEvents=function(a){a=a||{};var b=this.ctor.prototype,c={},d={},e={};for(var f in a){var g,h,i=_rx_domEvents.exec(f);if(i){var j=i[1];g="blur"===j?e[j]||(e[j]={}):c[j]||(c[j]={}),h=i[2]||""}else g=d,h=f;var k=a[f];"string"==typeof k&&(k=b[k]),null===k?g[h]=null:(g=g[h]||(g[h]=[]),g.push(k))}for(var j in c)_docEvents[j]||($(document).on(j,function(a){return a.button&&"click"===a.type?void 0:Factory._onevent(a)}),_docEvents[j]=!0);return[{dom:c,custom:d,local:e}]},Factory.prototype.create=function(a,b){var c=a.getAttribute("id");if(c||(c="nb-"+_id++,a.setAttribute("id",c)),_cache[c]||(_cache[c]={},null===_getName(a)&&a.setAttribute("data-nb",this.name)),!_cache[c][this.name]){var d=new this.ctor;if(d.id=c,d.__init(a),b)for(var e in b)d.on(e,b[e]);_cache[c][this.name]=d}return _cache[c][this.name]},Factory.prototype._extendEvents=function(a){function b(a,b){for(var c in b){var d=b[c],e=a[c];a[c]=null===e?[]:d.concat(e||[])}}var c=this.events[0].dom,d=a.events[0].dom;for(var e in d)b(c[e]||(c[e]={}),d[e]);b(this.events[0].custom,a.events[0].custom)},Factory._onevent=function(a){function b(){h=null;for(var a;a=o.parentNode;){if(i=_getName(o)){h=o;break}e.push(o),o=a}return h?(m&&n&&(e=l===h?[]:[l]),f=e.length,!0):void 0}function c(a,b){if(b){for(var c,i,j,k=0;f>k;k++){i=e[k],j=g[k]||(g[k]=$(i));for(var l in b)if(l&&j.is(l)&&!(m&&n&&$.contains(i,n))){var o=d(i,a,b[l]);o===!1&&(c=o)}if(c===!1)return c}var p=b[""];return!p||m&&n&&$.contains(h,n)?void 0:d(h,a,p)}}function d(b,c,d){for(var e=j.create(h),f=d.length;f--;){var g=d[f].call(e,a,b);if(g===!1)return!1;if(null===g)break}}var e,f,g,h,i,j,k=a.type,l=a.target,m="mouseover"===k||"mouseout"===k,n=a.relatedTarget,o=l;for(e=[],g=[],f=e.length;;){if(!b())break;for(var p=_getNames(i),q=!0,r=0;r<p.length;r++){var s=p[r];j=Factory.get(s);for(var t=j.events,u=0,v=t.length;v>u;u++)c(s,t[u].dom[k])===!1&&(q=!1)}if(!q)return!1;if(n)return;e.push(o),g.push($(o)),f=e.length,o=o.parentNode}},Factory.get=function(a){return _factories[a]},nb.hasBlock=function(a,b){var c=a.getAttribute("id");return!(!c||!_cache[c]||b&&!_cache[c][b])},nb.block=function(a,b,c){var d=_getName(a);return d?c?Factory.get(c).create(a,b):nb.blocks(a,b)[0]:null},nb.blocks=function(a,b){var c=_getName(a);if(!c)return[];for(var d=_getNames(c),e=[],f=0;f<d.length;f++)e.push(Factory.get(d[f]).create(a,b));return e},nb.find=function(a){var b=document.getElementById(a);return b?nb.block(b):void 0},nb.define=function(a,b,c){"string"!=typeof a&&(c=b,b=a,a="nb-"+_id++),c&&(c=Factory.get(c));var d=b.events;delete b.events;var e=function(){};nb.inherit(e,c?c.ctor:Block),nb.extend(e.prototype,b);var f=new Factory(a,e,d);return c&&f._extendEvents(c),_factories[a]=f,f},nb.init=function(a){a=a||document;for(var b=$(a).find("._init").addBack().filter("._init"),c=0,d=b.length;d>c;c++)nb.block(b[c])},nb.destroy=function(a){a=a||document;for(var b=$(a).find("._init").addBack().filter("._init"),c=0,d=b.length;d>c;c++){var e=b[c],f=e.getAttribute("id"),g=_cache[f];if(g)for(var h in g)g[h].destroy()}};var space=nb.define({events:{click:function(a){nb.trigger("space:click",a.target)}}}).create(document.getElementsByTagName("html")[0]);nb.on=function(a,b){return space.on(a,b)},nb.off=function(a,b){space.off(a,b)},nb.trigger=function(a,b){space.trigger(a,b)}}({},function(){return this}());